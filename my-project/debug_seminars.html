<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Seminar Loading</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Debug Seminar Loading</h1>
        
        <div class="row">
            <div class="col-md-6">
                <h3>Test Seminar Loading</h3>
                <button class="btn btn-primary" onclick="testSeminarLoading()">Load Seminar Topics</button>
                
                <div class="mt-3">
                    <label for="seminarSelect" class="form-label">Seminar Topics:</label>
                    <select class="form-select" id="seminarSelect" size="10">
                        <option value="">Click button above to load topics...</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-6">
                <h3>Console Output</h3>
                <div id="consoleOutput" class="border p-3 bg-light" style="height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                    Console output will appear here...
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Test Endpoints</h3>
                <div class="btn-group">
                    <button class="btn btn-info" onclick="testEndpoint('backend/test_seminars.php')">Test Database Connection</button>
                    <button class="btn btn-info" onclick="testEndpoint('backend/get_seminars.php')">Test Get Seminars</button>
                    <button class="btn btn-info" onclick="testEndpoint('backend/setup_database.php')">Test Setup Database</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Override console.log to also display in the page
        const originalLog = console.log;
        const originalError = console.error;
        const consoleOutput = document.getElementById('consoleOutput');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-danger' : 'text-dark';
            consoleOutput.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        async function testSeminarLoading() {
            console.log('=== Testing Seminar Loading ===');
            
            try {
                console.log('Fetching from backend/get_seminars.php...');
                const response = await fetch('backend/get_seminars.php');
                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('Response data:', result);
                
                if (result.success) {
                    const select = document.getElementById('seminarSelect');
                    select.innerHTML = '<option value="">Select a seminar topic...</option>';
                    
                    if (result.data && Object.keys(result.data).length > 0) {
                        let totalTopics = 0;
                        Object.keys(result.data).forEach(category => {
                            const optgroup = document.createElement('optgroup');
                            optgroup.label = category;
                            
                            result.data[category].forEach(seminar => {
                                const option = document.createElement('option');
                                option.value = seminar.topic;
                                option.textContent = seminar.topic;
                                optgroup.appendChild(option);
                                totalTopics++;
                            });
                            
                            select.appendChild(optgroup);
                        });
                        console.log(`Successfully loaded ${totalTopics} seminar topics in ${Object.keys(result.data).length} categories`);
                    } else {
                        console.error('No seminar data found in response');
                        select.innerHTML = '<option value="">No seminar topics available</option>';
                    }
                } else {
                    console.error('API returned error:', result.message);
                    document.getElementById('seminarSelect').innerHTML = '<option value="">Error: ' + result.message + '</option>';
                }
            } catch (error) {
                console.error('Error during seminar loading:', error);
                document.getElementById('seminarSelect').innerHTML = '<option value="">Error: ' + error.message + '</option>';
            }
        }

        async function testEndpoint(url) {
            console.log(`=== Testing ${url} ===`);
            
            try {
                const response = await fetch(url);
                console.log('Response status:', response.status);
                
                if (url.includes('setup_database.php')) {
                    // This returns HTML, not JSON
                    const text = await response.text();
                    console.log('Setup response (first 500 chars):', text.substring(0, 500));
                } else {
                    const result = await response.json();
                    console.log('Response data:', result);
                }
            } catch (error) {
                console.error(`Error testing ${url}:`, error);
            }
        }

        // Auto-load on page load
        window.addEventListener('load', function() {
            console.log('Debug page loaded. Ready to test seminar loading.');
        });
    </script>
</body>
</html>
